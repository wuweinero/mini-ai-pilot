(function(){"use strict";var e={1514:function(e,t,l){var n=l(9242),a=l(3396),i=l(4870),o=(l(560),l(7139)),s=l(7098),r=l(4268),u=l(7180),c=l(1649),d=l(6888),p=l(2876),f=l(7435),v=l(2074),m=l(1106),k=l(5747),y=l(681),g=l(5599);const h={style:{"max-height":"80vh","overflow-y":"auto"}},w={style:{"margin-top":"20px"}},b={style:{display:"flex","justify-content":"center",gap:"10px","margin-top":"10px"}};var _={__name:"FileTreeModal",props:{visible:{type:Boolean,required:!0},treeData:{type:Array,required:!0},clickedFiles:{type:Array,required:!0}},emits:["update:visible","update:clickedFiles"],setup(e,{emit:t}){const l=e,n=t,s=(0,i.iH)(l.visible);(0,a.YP)((()=>l.visible),(e=>{s.value=e}));const r=()=>{n("update:visible",!1)},u=(0,i.iH)(c(l.treeData));function c(e){return e.map((e=>{const t={title:e.name,key:e.key};return e.isFolder&&e.children&&e.children.length&&(t.children=c(e.children)),t}))}(0,a.YP)((()=>l.treeData),(e=>{u.value=c(e)}));const d=(e,t)=>{const a=e[0];if(!t.node.children){const e=l.clickedFiles.indexOf(a),t=[...l.clickedFiles];-1!==e&&t.splice(e,1),a&&t.push(a),n("update:clickedFiles",t)}},p=e=>{if(e>0){const t=[...l.clickedFiles],a=t[e];t.splice(e,1),t.splice(e-1,0,a),n("update:clickedFiles",t)}},f=e=>{if(e<l.clickedFiles.length-1){const t=[...l.clickedFiles],a=t[e];t.splice(e,1),t.splice(e+1,0,a),n("update:clickedFiles",t)}},v=e=>{const t=[...l.clickedFiles];t.splice(e,1),n("update:clickedFiles",t)},_=()=>{n("update:clickedFiles",[])};return(t,l)=>{const n=(0,a.up)("a-tree"),c=(0,a.up)("a-empty"),S=(0,a.up)("a-list-item"),x=(0,a.up)("a-list"),F=(0,a.up)("a-button"),U=(0,a.up)("a-modal");return(0,a.wg)(),(0,a.j4)(U,{visible:s.value,"onUpdate:visible":l[0]||(l[0]=e=>s.value=e),title:"上下文",onCancel:r,width:"90vw",footer:null},{default:(0,a.w5)((()=>[(0,a._)("div",h,[(0,a.Wm)(n,{treeData:u.value,defaultExpandAll:!1,onSelect:d},null,8,["treeData"]),(0,a._)("div",w,[0===e.clickedFiles.length?((0,a.wg)(),(0,a.j4)(c,{key:0,description:"点击选择上下文"})):((0,a.wg)(),(0,a.j4)(x,{key:1,dataSource:e.clickedFiles,bordered:""},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.clickedFiles,((e,t)=>((0,a.wg)(),(0,a.j4)(S,{key:e},{default:(0,a.w5)((()=>[(0,a._)("span",null,(0,o.zw)(e),1)])),actions:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(m.Z),{onClick:e=>p(t)},null,8,["onClick"]),(0,a.Wm)((0,i.SU)(k.Z),{onClick:e=>f(t)},null,8,["onClick"]),(0,a.Wm)((0,i.SU)(y.Z),{onClick:e=>v(t)},null,8,["onClick"])])),_:2},1024)))),128))])),_:1},8,["dataSource"])),(0,a._)("div",b,[(0,a.Wm)(F,{type:"primary",onClick:_},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(y.Z)),(0,a.Uk)(" 清空上下文 ")])),_:1}),(0,a.Wm)(F,{type:"primary",danger:"",onClick:r},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(g.Z)),(0,a.Uk)(" 关闭 ")])),_:1})])])])])),_:1},8,["visible"])}}},S=l(89);const x=(0,S.Z)(_,[["__scopeId","data-v-08858d34"]]);var F=x;const U={class:"quesiton-box"},W={key:1,class:"pre-container"},C={key:"comment-basic-like"},j={key:"comment-basic-dislike"},Z={key:1,class:"empty-container"};var O={__name:"Home",setup(e){const t=f.Z.PRESENTED_IMAGE_SIMPLE;let l;l=window.acquireVsCodeApi?window.acquireVsCodeApi():{postMessage:e=>{console.log("postMessage",e)},setState:e=>{console.log("setState",e)},getState:()=>({history:[]})};const n=(0,i.iH)(null),m=(0,i.iH)(null),k=(0,i.iH)(""),y=(0,i.iH)([]),g=(0,i.iH)(!1),h=(0,i.iH)(!1),w=(0,i.iH)([]),b=(0,i.iH)([]),_=()=>{l.postMessage({command:"files"}),h.value=!0},S=()=>{y.value=y.value.filter((e=>"system"===e.role)),P()},x=e=>{navigator.clipboard.writeText(e).then((function(){v.ZP.info("复制成功")}),(function(e){console.error("无法复制内容: ",e)}))},O=e=>{if(!g.value){if(e)y.value.pop();else{if(!k.value)return;y.value.push({role:"user",content:k.value}),k.value=""}g.value=!0,l.postMessage({command:"fetch",messages:JSON.stringify(y.value)})}},D=()=>l.postMessage({command:"abort"}),P=()=>l.postMessage({command:"systemPrompt",clickedFiles:JSON.stringify(b.value)}),H=async e=>{"Enter"===e.key&&(e.shiftKey||!k.value||g.value||(e.preventDefault(),await O()))};(0,a.bv)((()=>{(0,a.YP)(y,(()=>{M(),(0,a.Y3)((()=>{const e=n.value;e&&(e.scrollTop=e.scrollHeight)}))}),{deep:!0}),(0,a.YP)(b,(()=>{M(),P()}),{deep:!0}),P(),window.addEventListener("message",(e=>{const{data:t}=e;switch(t.command){case"response":{let e=t.text;y.value.length>0&&"assistant"===y.value[y.value.length-1].role?y.value[y.value.length-1].content+=e:y.value.push({role:"assistant",content:e}),t.finished&&(g.value=!1);break}case"reload":E();break;case"files":w.value=JSON.parse(t.files),A();break;case"systemPrompt":{const{prompt:e}=t;0===y.value.length?y.value.push({role:"system",content:e}):"system"===y.value[0].role?y.value[0].content=e:y.value.unshift({role:"system",content:e});break}default:break}}))}));const M=()=>{console.log("save",y.value,b.value),l.setState({history:y.value,clickedFiles:b.value})},E=()=>{let e=l.getState();console.log("load",e),e&&(y.value=e.history||[],b.value=e.clickedFiles||[])},A=()=>{const e=t=>{let l=[];return t.forEach((t=>{l.push(t.key),t.isFolder&&t.children.length>0&&(l=l.concat(e(t.children)))})),l},t=e(w.value);b.value=b.value.filter((e=>t.includes(e)))};return(e,l)=>{const f=(0,a.up)("a-textarea"),v=(0,a.up)("a-avatar"),P=(0,a.up)("MdPreview"),M=(0,a.up)("a-tooltip"),E=(0,a.up)("a-comment"),A=(0,a.up)("a-empty");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",U,[(0,a.Wm)((0,i.SU)(s.Z),{onClick:_,style:{"font-size":"20px","margin-right":"12px"}}),(0,a.Wm)((0,i.SU)(r.Z),{onClick:S,style:{"font-size":"20px"}}),(0,a.Wm)(f,{value:k.value,"onUpdate:value":l[0]||(l[0]=e=>k.value=e),placeholder:"Enter发送, Shift+Enter换行","auto-size":{maxRows:5},style:{width:"80vw",margin:"0 12px"},onKeydown:H,ref_key:"textArea",ref:m},null,8,["value"]),g.value?((0,a.wg)(),(0,a.j4)((0,i.SU)(c.Z),{key:1,onClick:D,style:{"font-size":"20px"}})):((0,a.wg)(),(0,a.j4)((0,i.SU)(u.Z),{key:0,onClick:l[1]||(l[1]=e=>O(!1)),style:{"font-size":"20px"}}))]),y.value.length>0?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"display-box",ref_key:"displayBox",ref:n},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(y.value,((e,t)=>((0,a.wg)(),(0,a.j4)(E,{key:t},(0,a.Nv)({content:(0,a.w5)((()=>["user"!==e.role?((0,a.wg)(),(0,a.j4)(P,{key:0,modelValue:e.content,theme:"dark"},null,8,["modelValue"])):((0,a.wg)(),(0,a.iD)("pre",W,(0,o.zw)(e.content),1))])),actions:(0,a.w5)((()=>[(0,a._)("span",C,[(0,a.Wm)(M,{title:"复制"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(d.Z),{style:{"font-size":"16px"},onClick:t=>x(e.content)},null,8,["onClick"])])),_:2},1024)]),"assistant"===e.role&&t===y.value.length-1?((0,a.wg)(),(0,a.iD)("span",j,[(0,a.Wm)(M,{title:"重新生成"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(p.Z),{style:{"font-size":"16px"},onClick:l[2]||(l[2]=e=>O(!0))})])),_:1})])):(0,a.kq)("",!0)])),_:2},["user"===e.role?{name:"author",fn:(0,a.w5)((()=>[(0,a.Uk)("我")])),key:"0"}:"assistant"===e.role?{name:"author",fn:(0,a.w5)((()=>[(0,a.Uk)("AI助手")])),key:"1"}:{name:"author",fn:(0,a.w5)((()=>[(0,a.Uk)("系统")])),key:"2"},"user"===e.role?{name:"avatar",fn:(0,a.w5)((()=>[(0,a.Wm)(v,{style:{color:"#f56a00","background-color":"#fde3cf"}},{default:(0,a.w5)((()=>[(0,a.Uk)("Q")])),_:1})])),key:"3"}:"assistant"===e.role?{name:"avatar",fn:(0,a.w5)((()=>[(0,a.Wm)(v,{style:{color:"#87ceeb","background-color":"#a0ffff"}},{default:(0,a.w5)((()=>[(0,a.Uk)("A")])),_:1})])),key:"4"}:{name:"avatar",fn:(0,a.w5)((()=>[(0,a.Wm)(v,{style:{color:"#ffffff","background-color":"#ffa500"}},{default:(0,a.w5)((()=>[(0,a.Uk)("S")])),_:1})])),key:"5"}]),1024)))),128))],512)):((0,a.wg)(),(0,a.iD)("div",Z,[(0,a.Wm)(A,{image:(0,i.SU)(t),description:"暂无内容"},null,8,["image"])])),(0,a.Wm)(F,{visible:h.value,treeData:w.value,clickedFiles:b.value,"onUpdate:visible":l[3]||(l[3]=e=>h.value=e),"onUpdate:clickedFiles":l[4]||(l[4]=e=>b.value=e)},null,8,["visible","treeData","clickedFiles"])])}}};const D=(0,S.Z)(O,[["__scopeId","data-v-f53486c6"]]);var P=D,H=l(9805),M=l(7334),E={__name:"App",setup(e){return(e,t)=>{const l=(0,a.up)("a-app"),n=(0,a.up)("a-config-provider");return(0,a.wg)(),(0,a.j4)(n,{locale:(0,i.SU)(H.Z),theme:{algorithm:(0,i.SU)(M.Z).darkAlgorithm}},{default:(0,a.w5)((()=>[(0,a.Wm)(l,null,{default:(0,a.w5)((()=>[(0,a.Wm)(P)])),_:1})])),_:1},8,["locale","theme"])}}};const A=E;var z=A,T=l(3706),q=(l(7424),l(9696));l(1849);const Y=(0,n.ri)(z);Y.use(T.M),Y.use(q.ZP),Y.mount("#app")}},t={};function l(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,l),i.exports}l.m=e,function(){var e=[];l.O=function(t,n,a,i){if(!n){var o=1/0;for(c=0;c<e.length;c++){n=e[c][0],a=e[c][1],i=e[c][2];for(var s=!0,r=0;r<n.length;r++)(!1&i||o>=i)&&Object.keys(l.O).every((function(e){return l.O[e](n[r])}))?n.splice(r--,1):(s=!1,i<o&&(o=i));if(s){e.splice(c--,1);var u=a();void 0!==u&&(t=u)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[n,a,i]}}(),function(){l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,{a:t}),t}}(),function(){l.d=function(e,t){for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){l.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};l.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,i,o=n[0],s=n[1],r=n[2],u=0;if(o.some((function(t){return 0!==e[t]}))){for(a in s)l.o(s,a)&&(l.m[a]=s[a]);if(r)var c=r(l)}for(t&&t(n);u<o.length;u++)i=o[u],l.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return l.O(c)},n=self["webpackChunksimple_vue"]=self["webpackChunksimple_vue"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=l.O(void 0,[998],(function(){return l(1514)}));n=l.O(n)})();
//# sourceMappingURL=app.9295ad41.js.map